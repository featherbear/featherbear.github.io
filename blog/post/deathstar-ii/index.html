<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><title>Deathstar II &middot; Andrew&#39;s Blog</title><meta name=description content="Upgrading my home-server"><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-107434487-3','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.4/css/bulma.min.css><link href=/blog/assets/prism.js/prism.css rel=stylesheet><script defer src=/blog/assets/prism.js/prism.js onload="let path;Prism.plugins.autoloader.languages_path=((path=this.getAttribute('src')).substring(0,path.lastIndexOf('/')))+'/languages/'"></script><script defer src=https://use.fontawesome.com/releases/v5.3.1/js/all.js></script><link rel=stylesheet href=/blog/css/site.css><style>body{background-image:url(/blog/IMG_0072.jpg)}</style><script defer src=/blog/js/site.js></script></head><body class=has-navbar-fixed-top><nav class="navbar is-fixed-top is-unselectable" role=navigation aria-label="main navigation"><div class=container><div class=navbar-brand><a class="navbar-item has-text-grey-darker is-size-3" href=/blog/>andrew wong</a>
<a role=button class="navbar-burger burger" aria-label=menu aria-expanded=false data-target=navmenu><span aria-hidden=true></span><span aria-hidden=true></span><span aria-hidden=true></span></a></div><div id=navmenu class=navbar-menu><div class=navbar-end><div class="navbar-item has-dropdown is-hoverable"><a class="navbar-link has-text-black-ter is-arrowless" href=/blog/>blog</a><div class=navbar-dropdown><a href=/blog/categories/ai class=navbar-item>ai</a><a href=/blog/categories/audio-visual class=navbar-item>audio-visual</a><a href=/blog/categories/life class=navbar-item>life</a><a href=/blog/categories/networking class=navbar-item>networking</a><a href=/blog/categories/photography class=navbar-item>photography</a><a href=/blog/categories/programming class=navbar-item>programming</a><a href=/blog/categories/python class=navbar-item>python</a><a href=/blog/categories/unsw class=navbar-item>unsw</a><a href=/blog/categories/webdev class=navbar-item>webdev</a></div></div><a class="navbar-item has-text-grey" href=/about>about me</a>
<a class="navbar-item has-text-grey" href=/photos>photography</a>
<a class="navbar-item has-text-grey" href=/programming>programming</a></div></div></div></nav><main class=container><header class="hero is-info"><div class=hero-body><div class=container><h1 class=title>Deathstar II</h1><h2 class=subtitle>Posted <time datetime=2019-12-09>Dec 9, 2019</time></h2></div></div></header><article id=content><p>The OpenMediaVault NAS VM running on my home server (<em>a HP ProLiant MicroServer Gen8, codename <code>deathstar</code></em>) has been slowly counting down the remaining available free space of its 3TB RAID-1 WD Red&rsquo;s.</p><p>With about 10GB free (as of 8/12/2019), it was time for a space upgrade!</p><blockquote><p>The two WD Red&rsquo;s were also nearing their life expectancy (supposedly about 3-5 years) as one drive was installed in March 2017, the other installed in September 2014.</p></blockquote><h1 id=before-we-begin>Before We Begin</h1><p>I don&rsquo;t really do RAID maintenance all that often, so alot of what I did was under guidance of the internet.<br><em>Because, you can trust everything you read on the internet right!?</em></p><h1 id=segue-pigone>Segue - PiGone!</h1><p>One of the VMs running on <code>deathstar</code> was <a href=https://pi-hole.net/>PiHole</a>, a software suite built to block ads on a DNS level.<br>While I originally had it set up and working well, I found myself constantly turning it off so that CashRewards and other online store purchasing rewards would work correctly.</p><p>At the end of the day I decided to get rid off it, since I was able to just toggle my browser&rsquo;s ad-blocker anyway.</p><p><img src=piHole.gif alt></p><h1 id=servers-off>Servers off!</h1><p>With the <code>deathstar</code> turned off, the first thing to do was to remove the old drives and install the brackets.</p><p><img src=20191208_202059.jpg alt></p><p><img src=20191208_234608.jpg alt></p><h1 id=enter-seagate>Enter, Seagate</h1><p>I opted for two Seagate IronWolf 8TB NAS hard drives (as they were cheaper than their WD Red counterparts during the time of purchase).</p><p><img src=20191208_210631.jpg alt></p><p>Now to install the drives, well just one for now&hellip;<br><strong>I only replaced one drive in the RAID</strong> so that I could sync/rebuild the existing data to the new drive.<br>When the rebuild is done, I will then be able to replace the other drive and do another rebuild.</p><table><thead><tr><th align=center></th><th align=center></th></tr></thead><tbody><tr><td align=center><img src=20191208_212129.jpg alt></td><td align=center><img src=20191208_212244.jpg alt></td></tr></tbody></table><p>Don&rsquo;t forget to label your drives too!
<img src=20191208_215129.jpg alt>
<img src=20191208_215235.jpg alt></p><h1 id=segue-adding-a-graphics-card>Segue - Adding a graphics card</h1><p>I decided to open up the server and give it abit of dust cleaning.<br>Since I had opened the case already, I installed a spare graphics card that I had (casually as you would) lying around.</p><p><img src=20191208_214058.jpg alt>
<img src=20191208_214643.jpg alt></p><p>But wait, I wasn&rsquo;t getting any output from the onboard VGA!?</p><p>Time to whip out and daisy chain a DMS59-&gt;DVI to a DVI-&gt;VGA adapter<br><img src=20191208_222750.jpg alt></p><p>There was also a bit of BIOS configuration that you needed to make in order to get the integrated/embedded graphics alongside with the dedicated graphics card.
<img src=20191208_222332.jpg alt></p><p>And everything&rsquo;s working okay again!<br><img src=20191208_215435.jpg alt></p><h1 id=updating-the-raid>Updating the RAID</h1><blockquote><p>Now to install the drives, well just one for now&hellip;<br><strong>I only replaced one drive in the RAID</strong> so that I could sync/rebuild the existing data to the new drive.<br>When the rebuild is done, I will then be able to replace the other drive and do another rebuild.</p></blockquote><p>With one of the NAS drives replaced I could then begin the first rebuild process.<br>But wait! There wasn&rsquo;t anything in the RAID Management tab on OpenMediaVault!</p><p>SSHing into OMV, I could see that the RAID was not currently running</p><pre><code>root@files:[~]: cat /proc/mdstat
Personalities : [linear] [multipath] [raid0] [raid1] [raid6] [raid5] [raid4] [raid10]
md0 : inactive sdb[0](S) sdc[2](S)
      10744031024 blocks super 1.2

unused devices: &lt;none&gt;
</code></pre><p>So we simply just had to start up the RAID again</p><pre><code>root@files:[~]: mdadm --run /dev/md0
mdadm: started array /dev/md0
</code></pre><p>With that, the RAID appeared back in OMV and we could see that it was rebuilding.</p><p><img src=Snipaste_2019-12-09_00-03-49.png alt>
<img src=Snipaste_2019-12-09_00-04-04.png alt></p><p>After a couple of hours (6 hours) the new drive was rebuilt, now I was able to remove the last existing drive and replace it with the new 8TB drive.<br>It&rsquo;s simply a matter of performing the same steps again!</p><h1 id=expansion>Expansion</h1><p>Finally with both 8TB drives installed, the last thing to do was to expand the RAID and the filesystem.</p><pre><code>root@files:[~]: mdadm --grow /dev/md0 --size=max
mdadm: component size of /dev/md0 has been set to 7813895512K

root@files:[~]: resize2fs /dev/md0
resize2fs 1.43.4 (31-Jan-2017)
Filesystem at /dev/md0 is mounted on /srv/dev-disk-by-label-hyperdrive; on-line resizing required
old_desc_blocks = 350, new_desc_blocks = 932
</code></pre><p>On the internet, they advised to do two things</p><p>1) Clear the bitmap (?)<br><code>mdadm --grow /dev/md0 --bitmap none</code></p><p>2) Unmount the RAID before expanding<br><code>umount /srv/dev-disk-by-label-hyperdrive</code></p><p>I didn&rsquo;t do either of these, and I assume they would increase the performance and decrease the time it would take.<br>But we&rsquo;re still alive.</p><h1 id=conclusion>Conclusion</h1><p>Both 8TB drives are now installed, and the 3TB drives can be put to some other use I guess..</p><p><img src=Snipaste_2019-12-09_17-52-57.png alt></p><p>We just have to wait for grow to complete, and we&rsquo;ll be on our way!<br><img src=Snipaste_2019-12-09_17-54-53.png alt></p></article></main><div class=container><h1 class="title has-text-grey-lighter">More posts</h1><div class=listArticle><a href=/blog/post/unsw-math3411/><article class=media><figure class=media-left><p class="image is-128x128"><img src=/blog/post/unsw-math3411/20191120_134300.jpg></p></figure><div class=media-content><h2 class="title is-marginless">UNSW MATH3411</h2><div class=level><div class=level-left><p class=subtitle>Information, Codes and Ciphers</p></div><div class=level-right><p>Posted <time datetime=2019-12-05>Dec 5, 2019</time></p></div></div></div></article><div class="is-unselectable categories"><a href=/blog/categories/unsw><span class="tag is-info">#UNSW</span></a></div></a></div></div><div id=scroll-nav></div><footer class=footer><nav class="breadcrumb is-right" aria-label=breadcrumbs><ul><li><a href=../../>blog</a></li><li><a href=../>post</a></li><li class=is-active><a href=# aria-current=page>deathstar-ii</a></li></ul></nav><hr><figure class="image is-128x128 logo" style="margin:0 auto"><img src=/blog/logo.png></figure></footer><link rel=stylesheet href=/blog/assets/luminous.js/luminous-basic.min.css><script src=/blog/assets/luminous.js/Luminous.min.js></script><script type=text/javascript>document.querySelectorAll("#content img").forEach(e=>new Luminous(e,{sourceAttribute:"src"}))</script><script src=/blog/assets/elevator.js/elevator.min.js></script><script type=text/javascript>var elevator=new Elevator({element:document.querySelector(".footer .logo"),mainAudio:'\/blog\/assets\/elevator.js\/elevator.mp3',endAudio:'\/blog\/assets\/elevator.js\/ding.mp3'});</script><script>{let max=document.body.scrollHeight-window.innerHeight;window.addEventListener('scroll',function(){document.getElementById('scroll-nav').style.width=`${this.scrollY/max*100}%`});document.getElementById('scroll-nav').style.width=`${window.scrollY/max*100}%`}</script></body></html>